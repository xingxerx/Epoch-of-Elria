#!/bin/bash

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘              EPOCH OF ELRIA GAME ENGINE                     â•‘"
echo "â•‘                   Windowed Application                      â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ðŸŒ Starting Epoch of Elria 3D Game Engine..."
echo ""

# Method 1: Try to create and open windowed HTML5 application
echo "ðŸ”¨ Building windowed application creator..."
g++ -std=c++17 -O2 create_windowed_app.cpp -o CreateWindowedApp

if [ $? -eq 0 ]; then
    echo "âœ… Build successful!"
    echo "ðŸš€ Creating and opening windowed application..."
    ./CreateWindowedApp

    # Keep terminal history visible
    echo ""
    echo "ðŸ“‹ TERMINAL HISTORY PRESERVED FOR TROUBLESHOOTING:"
    echo "âœ… Windowed application should be open in your browser"
    echo "ðŸ“ File created: EpochOfElriaEngine.html"
    echo "ðŸ”§ If window didn't open, manually open: EpochOfElriaEngine.html"
    echo ""
    echo "ðŸŽ® Windowed App Features:"
    echo "  â€¢ True browser window application"
    echo "  â€¢ Click objects to interact"
    echo "  â€¢ W/A/S/D movement controls"
    echo "  â€¢ Edit Mode toggle (E key)"
    echo "  â€¢ Platform creation (X key)"
    echo "  â€¢ Real-time camera info"
    echo ""
    echo "ðŸ’¡ Terminal remains open for troubleshooting"

else
    echo "âŒ Windowed app build failed! Using fallback console version..."
    echo ""

    # Fallback: Build and run console version but keep history
    if [ ! -f "EpochOfElriaEngine" ]; then
        echo "ðŸ”¨ Building console engine..."
        g++ -std=c++17 -O2 standalone_game_engine.cpp -o EpochOfElriaEngine

        if [ $? -ne 0 ]; then
            echo "âŒ Console build failed! Trying existing games..."
            if [ -f "standalone_game_engine" ]; then
                echo "âœ… Using existing standalone engine..."
                cp standalone_game_engine EpochOfElriaEngine
            elif [ -f "simple_3d_game" ]; then
                echo "âœ… Using simple 3D game..."
                cp simple_3d_game EpochOfElriaEngine
            else
                echo "âŒ No games available! Please install g++ compiler."
                echo ""
                echo "ðŸ“‹ TROUBLESHOOTING INFO:"
                echo "  â€¢ Current directory: $(pwd)"
                echo "  â€¢ Available files: $(ls *.cpp 2>/dev/null | head -5)"
                echo "  â€¢ g++ version: $(g++ --version 2>/dev/null | head -1 || echo 'Not installed')"
                exit 1
            fi
        fi
    fi

    echo "ðŸŽ® Starting console version (terminal history preserved)..."
    echo ""
    ./EpochOfElriaEngine

    echo ""
    echo "ðŸ“‹ TERMINAL HISTORY PRESERVED FOR TROUBLESHOOTING:"
    echo "âœ… Console version completed"
    echo "ðŸ”§ To get windowed version, ensure g++ is installed"
    echo "ðŸ’¡ Terminal remains open for troubleshooting"
fi

echo ""
echo "ðŸŒŸ Session complete - terminal history preserved for troubleshooting"
