#!/bin/bash

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘              EPOCH OF ELRIA GAME ENGINE                     â•‘"
echo "â•‘                   3D Windowed Application                   â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸŒ Starting Epoch of Elria 3D Game Engine..."

# Check if windowed engine exists, if not build it
if [ ! -f "EpochOfElriaEngine" ]; then
    echo "ğŸ”¨ Building 3D windowed application..."

    # Build the Linux windowed version with X11 and OpenGL
    g++ -std=c++17 -O2 linux_windowed_engine.cpp -o EpochOfElriaEngine -lGL -lGLU -lX11 -lglx 2>/dev/null

    if [ $? -ne 0 ]; then
        echo "âŒ X11/OpenGL build failed! Trying without glx..."
        g++ -std=c++17 -O2 linux_windowed_engine.cpp -o EpochOfElriaEngine -lGL -lGLU -lX11 2>/dev/null

        if [ $? -ne 0 ]; then
            echo "âŒ OpenGL build failed! Trying standalone version..."
            if [ ! -f "standalone_game_engine" ]; then
                echo "ğŸ”¨ Building standalone engine..."
                g++ -std=c++17 -O2 standalone_game_engine.cpp -o standalone_game_engine
            fi

            if [ -f "standalone_game_engine" ]; then
                echo "ğŸš€ Starting standalone engine (console mode)..."
                ./standalone_game_engine
            else
                echo "âŒ Could not build engine. Trying existing games..."
                if [ -f "simple_3d_game" ]; then
                    ./simple_3d_game
                elif [ -f "game_svg" ]; then
                    ./game_svg
                else
                    echo "âŒ No games available!"
                    echo ""
                    echo "To build the windowed version, install:"
                    echo "sudo apt install g++ libgl1-mesa-dev libglu1-mesa-dev libx11-dev"
                fi
            fi
            exit 1
        else
            echo "âœ… 3D windowed application built successfully!"
        fi
    else
        echo "âœ… 3D windowed application built successfully!"
    fi
fi

echo "ğŸš€ Launching Epoch of Elria 3D Game Engine..."
echo "ğŸ® Opening 3D application window..."
echo ""
echo "The 3D window should open on your screen!"
echo "If running in WSL, make sure you have an X server running."
echo ""

# Set display if needed
if [ -z "$DISPLAY" ]; then
    export DISPLAY=:0
fi

./EpochOfElriaEngine
